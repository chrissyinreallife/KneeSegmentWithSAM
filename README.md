# KneeSegmentWithSAM
Segmentation by registration-enabled SAM prompt engineering using five reference images

The recently proposed Segment Anything Model (SAM) is a powerful tool for image segmentation.  Despite its general success, using SAM for medical image segmentation faces challenges, especially for small, irregularly-shaped, and boundary-ambiguous anatomical structures like the knee cartilage. Repaired cartilage, after certain surgical procedures, exhibits unique imaging patterns, posing further challenges for using or fine-tuning general-purpose models like SAM. To address this, we propose a novel registration-based prompt engineering framework for medical image segmentation using SAM. This approach utilises image registration between the new image (to-be-segmented) and a small number of reference images, without segmentation labels. The spatial transformations generated by registration align either the new image or pre-defined point-based prompts, before using them as input to SAM. This strategy, requiring only five reference images with defined point prompts, effectively prompts SAM for inference on new images, without needing any segmentation labels. Evaluation on MR images from patients who received cartilage stem cell therapy yielded Dice scores of 0.89, 0.87, 0.53, and 0.52 for segmenting femur, tibia, femoral- and tibial cartilages, respectively. This outperforms atlas-based label fusion and is comparable to supervised nnUNet, a benchmark in this application, both of which require full segmentation labels for reference samples, for model construction or training. 

<img src="https://github.com/chrissyinreallife/KneeSegmentWithSAM/assets/143875903/58e0aacc-7007-42ab-9a2b-1f34494b8aec" width="50%" alt="fig_hor">

paper link: https://arxiv.org/abs/2407.17933

## **Prerequisites**

Before running the scripts included in this project, ensure you have the following prerequisites installed and properly configured:

**Installing NiftyReg:** A software package for efficient image registration, required for alignment and transformation tasks.

1.Download NiftyReg: Visit http://cmictig.cs.ucl.ac.uk/wiki/index.php/NiftyReg_install and download the latest version.

2.Compile NiftyReg: Follow the compilation instructions provided in the repository. Ensure you meet all the necessary dependencies.

**Installing Segment Anything (SAM):** A versatile tool for image segmentation, capable of segmenting a wide variety of objects in images.

1.Download SAM: Access the SAM tool from its official source. https://github.com/facebookresearch/segment-anything 

2.Installation Instructions: Follow the detailed installation instructions provided by SAM.

## **Support**

For issues, questions, or contributions, please open an issue on this repository or contact the project maintainer directly.
